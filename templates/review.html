<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Font Awesome Icon Library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
* {
  box-sizing: border-box;
}

body {
  font-family: Arial;
  margin: 0 auto; /* Center website */
  max-width: 800px; /* Max width */
  padding: 20px;
}

textarea {
  font-family: Arial;
}

.heading {
  font-size: 25px;
  margin-right: 25px;
}

.fa {
  font-size: 25px;
}

.checked {
  color: orange;
}

/* Three column layout */
.side {
  float: left;
  width: 15%;
  margin-top:10px;
}

.middle {
  margin-top:10px;
  float: left;
  width: 70%;
}

/* Place text to the right */
.right {
  text-align: right;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

/* The bar container */
.bar-container {
  width: 100%;
  background-color: #f1f1f1;
  text-align: center;
  color: white;
}

/* Individual bars */
.bar-5 {width: {{return_dict["percent"][5]}}%; height: 18px; background-color: #04AA6D;}
.bar-4 {width: {{return_dict["percent"][4]}}%; height: 18px; background-color: #2196F3;}
.bar-3 {width: {{return_dict["percent"][3]}}%; height: 18px; background-color: #00bcd4;}
.bar-2 {width: {{return_dict["percent"][2]}}%; height: 18px; background-color: #ff9800;}
.bar-1 {width: {{return_dict["percent"][1]}}%; height: 18px; background-color: #f44336;}

/* Responsive layout - make the columns stack on top of each other instead of next to each other */
@media (max-width: 400px) {
  .side, .middle {
    width: 100%;
  }
  .right {
    display: none;
  }
}

/* stars */
.rating{
  display : flex;
}

.rating input{
  position : absolute;
  left     : -100vw;
}

.rating label{
  width      : 48px;
  height     : 48px;
  padding    : 48px 0 0;
  overflow   : hidden;
  background : url('https://iamkate.com/code/star-rating-widget/stars.svg') no-repeat top left;
}

.rating:not(:hover) input:indeterminate + label,
.rating:not(:hover) input:checked ~ input + label,
.rating input:hover ~ input + label{
  background-position : -48px 0;
}

.rating:not(:hover) input:focus-visible + label{
  background-position : -96px 0;
}

.button {
  position: relative;
  background-color: #4CAF50;
  border: none;
  font-size: 28px;
  color: #FFFFFF;
  padding: 10px;
  width: 150px;
  text-align: center;
  transition-duration: 0.4s;
  text-decoration: none;
  overflow: hidden;
  cursor: pointer;
}

.button:after {
  content: "";
  background: #f1f1f1;
  display: block;
  position: absolute;
  padding-top: 300%;
  padding-left: 350%;
  margin-left: -20px !important;
  margin-top: -120%;
  opacity: 0;
  transition: all 0.8s
}

.button:active:after {
  padding: 0;
  margin: 0;
  opacity: 1;
  transition: 0s
}


.card {
  /* Add shadows to create the "card" effect */
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);

  transition: 0.3s;
}

/* On mouse-over, add a deeper shadow */
.card:hover {
  box-shadow: 2px 8px 16px 2px rgba(0,0,0,0.2);
}

/* Add some padding inside the card container */
.container {
  padding: 2px 16px;
  background: lightgrey;
}


</style>
</head>
<body>

<span class="heading">{{class_name}}</span>
<script>
let rating = {{average}}
rating = Math.round(rating)
for (let i = 0; i<rating; i++) {
  document.write('<span class="fa fa-star checked"></span>')
}
for (let i = rating; i<5; i++) {
  document.write('<span class="fa fa-star"></span>')
}
</script>
<!-- <span class="fa fa-star checked"></span>
<span class="fa fa-star checked"></span>
<span class="fa fa-star checked"></span>
<span class="fa fa-star checked"></span>
<span class="fa fa-star"></span> -->
<p>{{average}} average based on {{total_reviews_count}} reviews.</p>
<hr style="border:3px solid #f1f1f1">

<div class="row">
  <div class="side">
    <div>5 star</div>
  </div>
  <div class="middle">
    <div class="bar-container">
      <div class="bar-5"></div>
    </div>
  </div>
  <div class="side right">
    <div>{{ return_dict["count"][5] }}</div>
  </div>
  <div class="side">
    <div>4 star</div>
  </div>
  <div class="middle">
    <div class="bar-container">
      <div class="bar-4"></div>
    </div>
  </div>
  <div class="side right">
    <div>{{ return_dict["count"][4] }}</div>
  </div>
  <div class="side">
    <div>3 star</div>
  </div>
  <div class="middle">
    <div class="bar-container">
      <div class="bar-3"></div>
    </div>
  </div>
  <div class="side right">
    <div>{{ return_dict["count"][3] }}</div>
  </div>
  <div class="side">
    <div>2 star</div>
  </div>
  <div class="middle">
    <div class="bar-container">
      <div class="bar-2"></div>
    </div>
  </div>
  <div class="side right">
    <div>{{ return_dict["count"][2] }}</div>
  </div>
  <div class="side">
    <div>1 star</div>
  </div>
  <div class="middle">
    <div class="bar-container">
      <div class="bar-1"></div>
    </div>
  </div>
  <div class="side right">
    <div>{{ return_dict["count"][1] }}</div>
  </div>
</div>

<br>
<br>
<br>

<span class="heading">Leave your own review:</span>
<p>How would you rate this course from 1 to 5 stars?</p>
<div class="rating" name="rating">
  <input id="rating1" type="radio" name="rating" value="1">
  <label for="rating1">1</label>
  <input id="rating2" type="radio" name="rating" value="2">
  <label for="rating2">2</label>
  <input id="rating3" type="radio" name="rating" value="3">
  <label for="rating3">3</label>
  <input id="rating4" type="radio" name="rating" value="4">
  <label for="rating4">4</label>
  <input id="rating5" type="radio" name="rating" value="5">
  <label for="rating5">5</label>
</div>
<br>
<textarea id="review_text" rows="4" cols="50" placeholder="Type a review here"></textarea><br>
<br>
<button class="button" onclick="submit()">Submit</button>
<br>
<br>


{% for comment in comments %}


<div class="card">
  <div class="container">
    <!-- <h4><b>John Doe</b></h4> -->
    <p><b>Rating: {{comment.rating}}</b></p>
    <p>{{comment.comment_text}}</p>
  </div>
</div>
<br>

{% endfor %}

<script>

function submit() {

  var radios = document.getElementsByName('rating');
  var review_text = document.getElementById('review_text').value;
  console.log(review_text);
  for (var i = 0, length = radios.length; i < length; i++) {
    if (radios[i].checked) {
      // do whatever you want with the checked radio
      rating = radios[i].value;
      // fetch('/add/{{class_id}}/'+radios[i].value)

      // fetch('./add/{{class_id}}/'+rating)
      //   .then(data => console.log(data));

      fetch('./add/{{class_id}}/'+rating, {
        method: "POST",
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({comment_text: review_text})
      }).then(res => {
        console.log("Request complete! response:", res);
      });
      window.location.reload(); // refresh page after submission




        // .then(response => response.json())
        // .then(data => console.log(data));

      // only one radio can be logically checked, don't check the rest
      return;
    }
  }
  alert("You must select a rating")

}

</script>


</body>
</html>
